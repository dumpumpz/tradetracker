:root {
    --bg-color: #f4f7f6;
    --container-bg: #fff;
    --text-color: #333;
    --border-color: #ddd;
    --header-bg: #e9ecef;
    --link-color: #007bff;
    --subtle-text: #666;
    --card-bg: #fafafa;
    --shadow-color: rgba(0,0,0,0.1);
    --green-bg: #d4edda;
    --red-bg: #f8d7da;
    --purple-bg: #e2d9f3;
    --green-border: #c3e6cb;
    --red-border: #f5c6cb;
    --green-text: #155724;
    --red-text: #721c24;
    --green-bar: rgba(40, 167, 69, 0.2);
    --red-bar: rgba(220, 53, 69, 0.2);

}

[data-theme="dark"] {
    --bg-color: #121212;
    --container-bg: #1e1e1e;
    --text-color: #e0e0e0;
    --border-color: #444;
    --header-bg: #2c2c2c;
    --link-color: #58a6ff;
    --subtle-text: #888;
    --card-bg: #2a2a2a;
    --shadow-color: rgba(0,0,0,0.4);
    --green-bg: #1c3b23;
    --red-bg: #4d1f24;
    --purple-bg: #3c2a4d;
    --green-border: #285732;
    --red-border: #6b282e;
    --green-text: #a7d7b2;
    --red-text: #f5b7bd;
    --green-bar: rgba(40, 167, 69, 0.4);
    --red-bar: rgba(220, 53, 69, 0.4);
}

body { 
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
    margin: 0; 
    padding: 10px; 
    background-color: var(--bg-color); 
    color: var(--text-color);
    transition: background-color 0.3s, color 0.3s;
}
.container { max-width: 1200px; margin: auto; background: var(--container-bg); padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px var(--shadow-color); transition: background-color 0.3s; }
h1 { text-align: center; color: var(--text-color); margin-bottom: 5px; }
h2 { margin-top: 40px; border-top: 1px solid var(--border-color); padding-top: 20px; }
h3 { text-align: center; color: var(--text-color); margin-top: 30px; margin-bottom: -5px; font-weight: 500;}
.section-header { display: flex; justify-content: center; align-items: center; position: relative; }
.backup-controls { position: absolute; right: 0; display: flex; gap: 10px; }
.backup-controls button, .backup-controls label { font-size: 12px; padding: 6px 12px; cursor: pointer; background-color: #6c757d; border: none; color: white; border-radius: 4px; }
.backup-controls input[type="file"] { display: none; }
p.subtitle { text-align: center; font-style: italic; margin-top: 0; color: var(--subtle-text); }
.tabs { display: flex; flex-wrap: wrap; border-bottom: 2px solid var(--border-color); margin-bottom: 20px; }
.tab-link { padding: 10px 20px; cursor: pointer; border: none; background-color: transparent; font-size: 16px; font-weight: 500; color: var(--subtle-text); border-bottom: 2px solid transparent; margin-bottom: -2px; }
.tab-link.active { color: var(--link-color); border-bottom-color: var(--link-color); }
.tab-content { display: none; }
.tab-content.active { display: block; }

.master-only { display: none; }
#add-trade-form { margin: 0 auto; padding: 0; border: none; border-radius: 0; background-color: transparent; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; align-items: end; }
label { margin-bottom: 5px; font-weight: bold; font-size: 14px; }
input, select, button, textarea { padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 14px; width: 100%; box-sizing: border-box; font-family: inherit; background-color: var(--container-bg); color: var(--text-color); }
button { background-color: #007bff; color: white; border: none; cursor: pointer; transition: background-color 0.3s; margin-top: 5px; }
button:hover { opacity: 0.85; }

.table-wrapper { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid var(--border-color); padding: 8px; text-align: left; font-size: 14px; white-space: nowrap; vertical-align: top; }
th { background-color: var(--header-bg); font-weight: bold; vertical-align: middle; text-align: center; }
.action-buttons button { padding: 5px 8px; font-size: 12px; margin-right: 4px; }

.note-cell { white-space: normal; max-width: 300px; min-width: 250px; font-size: 12px; line-height: 1.4; }

#journal-tab, #sr-levels-tab { position: relative; }
.controls-container { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 20px; margin: 20px auto; }
.controls-container > div { display: flex; align-items: center; gap: 8px; }

#journal-entry, #persistent-notes-entry, #tracker-scratchpad, .setups-notes-area {
    width: 100%; 
    resize: vertical;
    line-height: 1.6;
    margin-top: 5px;
    overflow-y: hidden; 
    min-height: 120px; 
}
#tracker-scratchpad, #persistent-notes-entry { margin: 0; }
.setups-notes-area {
    margin-top: 15px;
    min-height: 80px;
}

#journal-entry:read-only, #persistent-notes-entry:read-only, #tracker-scratchpad:read-only, .setups-notes-area:read-only { 
    background-color: var(--card-bg); 
    cursor: not-allowed; 
}

#image-upload-section { margin-top: 20px; border-top: 1px dashed var(--border-color); padding-top: 20px; }
.image-upload-label { background-color: #28a745; color: white; padding: 10px 15px; border-radius: 5px; cursor: pointer; text-align: center; display: inline-block; }
#journal-image-upload, #library-image-upload { display: none; }
#upload-progress { margin-top: 10px; font-style: italic; color: var(--link-color); }
#journal-images-container { margin-top: 20px; display: flex; flex-direction: column; gap: 15px; }
.journal-image-wrapper { position: relative; max-width: 80%; border: 1px solid var(--border-color); padding: 5px; background: var(--card-bg); border-radius: 4px; }
.journal-image-wrapper img { max-width: 100%; height: auto; display: block; border-radius: 2px; cursor: pointer; }

.delete-journal-image { position: absolute; top: 12px; right: 12px; width: 32px; height: 32px; border-radius: 50%; background-color: rgba(220, 53, 69, 0.85); border: 1px solid rgba(255,255,255,0.4); display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10; transition: all 0.2s ease-in-out; opacity: 0.7; padding: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
.journal-image-wrapper:hover .delete-journal-image { opacity: 1; }
.delete-journal-image svg { width: 16px; height: 16px; fill: white; }

#ema-key-container { margin: 25px auto; padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--card-bg); max-width: 80%; }
#ema-key-container h4 { text-align: center; margin-top: 0; margin-bottom: 15px; color: var(--subtle-text); }
.ema-key-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px 25px; }
.key-item { display: flex; align-items: center; }
.key-color-swatch { width: 16px; height: 16px; border-radius: 50%; margin-right: 8px; border: 1px solid var(--border-color); }
.key-label { font-size: 14px; }

#journal-tab.drag-over { border: 3px dashed var(--link-color); background-color: rgba(0, 123, 255, 0.05); }
#journal-tab.drag-over::before { content: "Drop Image Here"; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.8); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; color: var(--link-color); z-index: 999; pointer-events: none; }

#stats-panel-container { position: fixed; bottom: 20px; left: 20px; z-index: 1000; }
#stats-fab { width: 60px; height: 60px; border-radius: 50%; background-color: #007bff; color: white; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.2s ease-in-out; }
#stats-fab:hover { opacity: 0.9; }
#stats-fab svg { width: 28px; height: 28px; fill: white; }
#stats-panel { position: absolute; bottom: 80px; left: 0; width: 300px; background: var(--container-bg); border-radius: 12px; box-shadow: 0 6px 20px var(--shadow-color); padding: 15px; opacity: 0; transform: translateY(20px); transition: opacity 0.3s ease, transform 0.3s ease, background-color 0.3s; pointer-events: none; }
#stats-panel.active { opacity: 1; transform: translateY(0); pointer-events: auto; }
.stats-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 15px; }
.stats-header h3 { margin: 0; font-size: 18px; color: var(--text-color); }
#close-stats-btn { background: none; border: none; font-size: 24px; font-weight: bold; color: var(--subtle-text); cursor: pointer; padding: 0 5px; line-height: 1; margin: 0; }
.stats-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
.stat-item { display: flex; justify-content: space-between; align-items: baseline; padding: 5px 0; }
.stat-label { font-size: 14px; color: var(--subtle-text); }
.stat-value { font-size: 16px; font-weight: 600; color: var(--text-color); }
#stat-balance-aud { font-size: 14px; color: var(--subtle-text); }

.date-nav-container { display: flex; justify-content: center; align-items: center; gap: 10px; margin: 15px auto 20px auto; }
#date-buttons-container { display: flex; gap: 8px; }
.date-nav-btn { padding: 8px 12px; font-size: 14px; background-color: var(--card-bg); border: 1px solid var(--border-color); color: var(--subtle-text); border-radius: 6px; cursor: pointer; transition: all 0.2s ease; border-bottom: 3px solid transparent; }

.date-nav-btn.active { background-color: var(--link-color); color: white; border-color: var(--link-color); font-weight: bold; }
.date-nav-btn.has-entry { border-bottom: 3px solid var(--green-border); }
.date-nav-arrow { background: none; border: none; font-size: 24px; font-weight: bold; color: var(--subtle-text); cursor: pointer; padding: 0 10px; }


#ema-data-section { margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border-color); }
#ema-data-section h2 { margin-top: 0; border-top: none; text-align: center; }
.ema-last-updated { text-align: center; font-style: italic; color: var(--subtle-text); font-size: 14px; margin-bottom: 20px; }
.ema-table-container { margin-bottom: 30px; }
.ema-table-container h4 { font-size: 11px; margin-bottom: 5px; text-align: center; }
.ema-table-container .current-price-display { text-align: center; font-size: 11px; color: var(--text-color); }
.price-value { font-weight: bold; }
.ema-table th, .ema-table td { font-family: inherit; font-size: 11px; padding: 10px 8px; }
.ema-table th { font-weight: bold; background-color: var(--header-bg); color: var(--subtle-text); }
.ema-table td:first-child { font-weight: bold; text-align: left; color: var(--link-color); padding-left: 15px; }
.ema-table .separator-row td {
    border-top: 2px solid var(--border-color);
    padding: 2px;
    background-color: var(--bg-color);
}

.ema-summary-container {
    font-size: 13px;
    padding: 8px 12px;
    margin: 0 auto 15px auto;
    max-width: 95%;
    border-radius: 6px;
    background-color: var(--bg-color);
}
.ema-level-summary-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}
.ema-summary-container h4 {
    font-size: 14px;
    text-align: center;
    margin-top: 5px;
    margin-bottom: 10px;
    color: var(--subtle-text);
}
.ema-level-summary {
    line-height: 1.5;
}

.ema-level-summary ul {
    margin: 5px 0 0 0;
    padding-left: 20px;
    list-style-type: disc;
}
.ema-level-summary li {
    margin-bottom: 4px;
    line-height: 1.4;
}
.ema-level-summary strong {
    font-weight: 600;
}
.ema-level-summary .support { color: var(--green-text); }
.ema-level-summary .resistance { color: var(--red-text); }

#sr-legend-container {
    margin: 0 auto 10px auto;
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    overflow: hidden;
}
#sr-legend-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    cursor: pointer;
    border-bottom: 1px solid var(--border-color);
    transition: border-color 0.3s ease;
}
#sr-legend-header.collapsed {
    border-bottom-color: transparent;
}
#sr-legend-header h4 {
    margin: 0;
    font-size: 16px;
    color: var(--text-color);
    font-weight: 500;
}
#sr-legend-toggle-btn {
    background: none;
    border: 1px solid var(--border-color);
    color: var(--subtle-text);
    width: 24px;
    height: 24px;
    border-radius: 50%;
    font-size: 20px;
    line-height: 20px;
    text-align: center;
    cursor: pointer;
    padding: 0;
    font-weight: bold;
    margin: 0;
    transition: transform 0.3s ease, color 0.2s, border-color 0.2s;
}
#sr-legend-header:hover #sr-legend-toggle-btn {
    border-color: var(--link-color);
    color: var(--link-color);
}
#sr-legend-content {
    padding: 15px;
    display: block;
}
#sr-metadata-container {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
    gap: 20px;
    padding: 0;
    margin: 0;
    background-color: transparent;
    border: none;
    text-align: center;
}
#sr-levels-tab .controls-container {
    margin-bottom: 25px;
    padding: 10px;
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
}

.metadata-item { font-size: 14px; }
.metadata-label { font-weight: bold; color: var(--subtle-text); display: block; margin-bottom: 4px; }
.metadata-value { font-family: 'Courier New', Courier, monospace; color: var(--text-color); }
.rating-explanation { text-align: left; margin-top: 5px; font-size: 13px; line-height: 1.5; white-space: pre; }

#sr-levels-container { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px; }
.sr-column h3 { text-align: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid; }
.sr-column.support h3 { color: #28a745; border-color: #28a745; }
.sr-column.resistance h3 { color: #dc3545; border-color: #dc3545; }

.sr-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 0;
}
.sr-table th, .sr-table td {
    font-size: 13px;
    padding: 8px;
    text-align: right;
    border-bottom: 1px solid var(--border-color);
    border-left: none;
    border-right: none;
}
.sr-table th {
    text-align: center;
    font-weight: 500;
    color: var(--subtle-text);
    border-top: none;
}
.sr-table tr:last-child td {
    border-bottom: none;
}
.sr-table td:first-child, .sr-table th:first-child {
    text-align: center;
}
.sr-table .sr-center-price {
    font-weight: bold;
    font-family: 'Courier New', Courier, monospace;
}
.sr-table .sr-score-cell {
    position: relative;
    background-repeat: no-repeat;
    background-position: left center;
}
.sr-table .sr-score-value {
    position: relative;
    z-index: 1;
    background-color: var(--container-bg); 
    padding: 1px 4px;
    border-radius: 3px;
}
.sr-table .sr-pivots-cell {
    color: var(--subtle-text);
}

.price-above { color: #dc3545 !important; }
.price-below { color: #28a745 !important; }

.theme-switch-wrapper { display: flex; align-items: center; position: absolute; top: 15px; right: 20px; z-index: 10; }
.theme-switch { display: inline-block; height: 24px; position: relative; width: 50px; }
.theme-switch input { display: none; }
.slider { background-color: #ccc; bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; }
.slider:before { background-color: #fff; bottom: 4px; content: ""; height: 16px; left: 4px; position: absolute; transition: .4s; width: 16px; }
input:checked + .slider { background-color: var(--link-color); }
input:checked + .slider:before { transform: translateX(26px); }
.slider.round { border-radius: 34px; }
.slider.round:before { border-radius: 50%; }

.journal-input-wrapper {
    position: relative;
}
#favourite-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    font-size: 20px;
    padding: 0;
    margin: 0;
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    color: #ccc; 
    cursor: pointer;
    display: none; 
    transition: all 0.2s ease;
    z-index: 5;
}
#favourite-btn:hover {
    border-color: #ffc107;
    color: #ffc107;
}
#favourite-btn.active {
    color: #ffc107;
    border-color: #ffc107;
    box-shadow: 0 0 8px rgba(255, 193, 7, 0.5);
}
#favourited-entry-container {
    background-color: var(--purple-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
}
.favourited-header {
    display: flex;
    align-items: center;
    font-weight: bold;
    color: var(--text-color);
    margin-bottom: 10px;
    font-size: 14px;
}
.favourited-header .star-icon {
    font-size: 18px;
    margin-right: 8px;
    color: #ffc107;
}
#favourited-entry-text {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 14px;
    line-height: 1.6;
    color: var(--text-color);
}

.setups-table th:first-child { text-align: left; padding-left: 15px; color: var(--link-color); }
.setups-table td { text-align: center; }
.setups-table .editable-setup-cell[contenteditable="true"]:focus {
    background-color: var(--header-bg);
    outline: 2px solid var(--link-color);
    box-shadow: 0 0 5px var(--shadow-color);
}

.setups-table td.highlight-long {
    background-color: var(--green-bg);
    color: var(--green-text);
    font-weight: bold;
}
.setups-table td.highlight-short {
    background-color: var(--red-bg);
    color: var(--red-text);
    font-weight: bold;
}

.setups-table .percent-cell {
    font-size: 11px;
    color: var(--subtle-text);
    text-align: right;
    padding-right: 10px;
    font-style: italic;
}

.setups-table thead tr:first-child th:nth-child(n+2) {
    border-top: 2px solid yellow;
}
.setups-table tbody tr:last-child td:nth-child(n+1),
.setups-table thead tr:last-child th:nth-child(n+1) {
    border-bottom: 2px solid yellow;
}
.setups-table thead tr:first-child th:nth-child(2), 
.setups-table thead tr:last-child th:nth-child(1),
.setups-table tbody td:nth-child(2),
.setups-table thead tr:first-child th:nth-child(3),
.setups-table thead tr:last-child th:nth-child(6),
.setups-table tbody td:nth-child(7),
.setups-table thead tr:first-child th:nth-child(4),
.setups-table thead tr:last-child th:nth-child(11),
.setups-table tbody td:nth-child(12) {
    border-left: 2px solid yellow;
}
.setups-table thead tr:first-child th:nth-child(2),
.setups-table thead tr:last-child th:nth-child(5),
.setups-table tbody td:nth-child(6),
.setups-table thead tr:first-child th:nth-child(3),
.setups-table thead tr:last-child th:nth-child(10),
.setups-table tbody td:nth-child(11),
.setups-table thead tr:first-child th:nth-child(4),
.setups-table thead tr:last-child th:nth-child(15),
.setups-table tbody td:nth-child(16) {
    border-right: 2px solid yellow;
}

.setups-container {
    margin-bottom: 30px; 
    border: 1px solid var(--border-color);
    padding: 15px;
    border-radius: 8px;
    background-color: var(--card-bg);
}
.setups-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 10px;
    cursor: pointer;
}
.setups-header h2 {
    margin: 0;
    font-size: 18px;
    padding: 0;
    border: none;
}
.setups-toggle-btn {
    background: none;
    border: 1px solid var(--border-color);
    color: var(--subtle-text);
    width: 24px;
    height: 24px;
    border-radius: 50%;
    font-size: 20px;
    line-height: 20px;
    text-align: center;
    cursor: pointer;
    padding: 0;
    font-weight: bold;
    margin: 0;
    transition: transform 0.3s ease, color 0.2s, border-color 0.2s;
}
.setups-header:hover .setups-toggle-btn {
    border-color: var(--link-color);
    color: var(--link-color);
}
.setups-controls {
    text-align: center;
    margin-top: 15px;
}
.setups-controls button {
    margin: 0 10px;
}
.setups-save-status {
    text-align:center;
    font-style:italic;
    color:var(--subtle-text);
    height:1em;
}

#asset-sentiment-container h4 {
    text-align: center;
    margin-top: 0;
    margin-bottom: 5px;
    border: none;
    padding: 0;
}
.sentiment-trackers-wrapper {
    display: flex;
    justify-content: space-around;
    gap: 20px;
    flex-wrap: wrap;
    margin-top: 20px;
}
.sentiment-tracker {
    flex: 1;
    min-width: 250px;
    max-width: 400px;
    text-align: center;
}
.sentiment-tracker h4 {
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 16px;
    color: var(--subtle-text);
}
.sentiment-buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
}
.sentiment-buttons button {
    flex: 1;
    border: 1px solid var(--border-color);
    background-color: transparent;
    color: var(--text-color);
    padding: 8px 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: 500;
}
.sentiment-buttons button:hover {
    opacity: 1;
    border-color: var(--link-color);
}
.sentiment-buttons button:active {
    transform: scale(0.95);
    background-color: var(--header-bg);
}
.sentiment-note-cell {
    white-space: normal;
    min-width: 300px;
    font-size: 13px;
}
#sentiment-receipts-table td:nth-child(2) {
    text-transform: capitalize;
    font-weight: bold;
}
.delete-sentiment-btn {
    background: none;
    border: none;
    color: var(--red-text);
    font-weight: bold;
    font-size: 18px;
    cursor: pointer;
    padding: 0 5px;
    margin: 0;
    line-height: 1;
    opacity: 0.6;
}
.delete-sentiment-btn:hover {
    opacity: 1;
}

.editable-cell[contenteditable="true"]:focus {
    background-color: var(--header-bg);
    outline: 2px solid var(--link-color);
    box-shadow: 0 0 5px var(--shadow-color);
}

.edit-sentiment-note-btn {
    background-color: var(--subtle-text);
    color: var(--container-bg);
    border: none;
}
.edit-sentiment-note-btn:hover {
    background-color: var(--link-color);
}

.toggle-history-btn {
    font-size: 12px;
    padding: 4px 10px;
    margin: 15px auto 0 auto;
    cursor: pointer;
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    color: var(--subtle-text);
    border-radius: 4px;
    display: none; 
}
.toggle-history-btn:hover {
    border-color: var(--link-color);
    color: var(--link-color);
}
.section-header h2 {
    margin-bottom: 0; 
}

.historical-entry {
    display: none;
}
.pagination-controls {
    text-align: center;
    margin-top: 15px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
}
.pagination-btn {
    padding: 6px 12px;
    font-size: 14px;
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    color: var(--subtle-text);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
}
.pagination-btn:hover:not(:disabled) {
    border-color: var(--link-color);
    color: var(--link-color);
}
.pagination-btn:disabled {
    cursor: not-allowed;
    opacity: 0.5;
}
#sentiment-page-info {
    font-size: 14px;
    color: var(--subtle-text);
}


#image-library-container, #setups-image-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 10px;
}
.library-image-wrapper {
    position: relative;
    border: 1px solid var(--border-color);
    padding: 5px;
    background: var(--container-bg);
    border-radius: 4px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}
.library-image-wrapper img {
    width: 100%;
    object-fit: contain;
    aspect-ratio: 16 / 9;
    display: block;
    border-radius: 2px;
    cursor: pointer;
    flex-grow: 1; 
    min-height: 0;
}
.library-image-wrapper:hover .delete-library-image,
.library-image-wrapper:hover .edit-caption-btn {
    opacity: 1;
}
.delete-library-image {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background-color: rgba(220, 53, 69, 0.85);
    border: 1px solid rgba(255,255,255,0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
    transition: all 0.2s ease-in-out;
    opacity: 0;
    padding: 0;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}

.delete-library-image svg {
    width: 14px;
    height: 14px;
    fill: white;
}
.edit-caption-btn {
    position: absolute;
    top: 8px;
    left: 8px;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background-color: rgba(0, 123, 255, 0.85);
    border: 1px solid rgba(255,255,255,0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
    transition: all 0.2s ease-in-out;
    opacity: 0;
    padding: 0;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}

.edit-caption-btn svg {
    width: 14px;
    height: 14px;
    fill: white;
}
.library-image-caption {
    font-size: 12px;
    line-height: 1.4;
    color: var(--subtle-text);
    padding: 8px 4px 4px 4px;
    text-align: center;
    flex-shrink: 0;
    word-wrap: break-word;
}
.library-image-caption.is-today {
    color: #ffc107;
    font-weight: 500;
}

.modal-overlay {
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.85);
    display: flex;
    justify-content: center;
    align-items: flex-start; 
    padding: 20px 0;
    overflow-y: auto;
    animation-name: fadeIn;
    animation-duration: 0.3s;
}
#image-modal .modal-content {
    margin: auto;
    display: block;
    max-width: 90vw;
    max-height: 85vh;
    animation-name: zoomIn;
    animation-duration: 0.4s;
}

@keyframes fadeIn {
    from {opacity: 0}
    to {opacity: 1}
}
@keyframes zoomIn {
    from {transform:scale(0.1)}
    to {transform:scale(1)}
}
.modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    transition: 0.3s;
    cursor: pointer;
    z-index: 2002;
}
.modal-close:hover,
.modal-close:focus {
    color: #bbb;
    text-decoration: none;
    cursor: pointer;
}
#modal-caption {
    text-align: center;
    color: #ccc;
    padding: 15px 0;
    font-size: 18px;
    line-height: 1.4;
    max-width: 80vw;
    word-wrap: break-word; 
}
.modal-nav {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    width: 50px;
    height: 50px;
    background-color: rgba(255, 255, 255, 0.2);
    color: #fff;
    border: none;
    border-radius: 50%;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2001;
    transition: background-color 0.2s ease;
}
.modal-nav:hover {
    background-color: rgba(255, 255, 255, 0.4);
}
#modal-prev { left: 20px; }
#modal-next { right: 20px; }

.in-merge-mode #completed-trades-tbody tr {
    cursor: crosshair;
}
.in-merge-mode #completed-trades-tbody tr:hover {
    background-color: var(--header-bg);
}
#completed-trades-tbody tr.is-merge-base {
    background-color: var(--purple-bg) !important;
    color: var(--text-color);
}
#completed-trades-tbody tr.is-merge-base td {
    font-weight: bold;
}

#chart-library-2-container {
    min-height: 150px;
}
.cl2-folder-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 12px;
}
.cl2-folder-card {
    position: relative;
    border: 1px solid var(--border-color);
    background-color: var(--container-bg);
    border-radius: 8px;
    padding: 10px;
    text-align: center;
    cursor: pointer;
    transition: border-color 0.2s ease-in-out;
    aspect-ratio: 1 / 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}
.cl2-folder-card:hover {
    border-color: var(--link-color);
}
.cl2-folder-card h4 {
    margin: 8px 0 4px 0;
    font-size: 14px;
    font-weight: 500;
    color: var(--text-color);
    text-transform: capitalize;
}
.cl2-folder-icon {
    font-size: 32px;
    color: var(--link-color);
}
.cl2-folder-count {
    font-size: 12px;
    color: var(--subtle-text);
}
.cl2-folder-card.drag-over {
    border-color: var(--link-color);
    border-style: dashed;
    background-color: var(--header-bg);
}
.cl2-image-view-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}
.cl2-back-button {
    padding: 8px 16px;
    font-size: 14px;
}
.cl2-view-title {
    margin: 0;
    font-size: 20px;
    text-transform: capitalize;
    color: var(--text-color);
}
.cl2-image-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
}

#chart-library-2-preview-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
}
.cl2-preview-item h4 {
    text-align: center;
    margin-bottom: 10px;
    margin-top: 0;
    font-size: 18px;
    color: var(--subtle-text);
    text-transform: capitalize;
}

.collapsible-section {
    border: 1px solid var(--border-color);
    border-radius: 8px;
    margin-bottom: 20px;
    background-color: var(--card-bg);
    overflow: hidden; 
}
.collapsible-section.master-only {
    display: none;
}
.collapsible-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 20px;
    cursor: pointer;
    background-color: var(--header-bg);
    transition: background-color 0.2s ease;
}
.collapsible-header h2 {
    margin: 0;
    padding: 0;
    border: none;
    font-size: 1.1em;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 15px;
}
.collapsible-toggle-btn {
    background: none;
    border: 1px solid var(--border-color);
    color: var(--subtle-text);
    width: 28px;
    height: 28px;
    border-radius: 50%;
    font-size: 22px;
    line-height: 26px;
    font-weight: bold;
    padding: 0;
    margin: 0;
    text-align: center;
    transition: transform 0.3s ease, background-color 0.2s, border-color 0.2s, color 0.2s;
    flex-shrink: 0;
}
.collapsible-header:hover .collapsible-toggle-btn {
    border-color: var(--link-color);
    color: var(--link-color);
}
.collapsible-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease-in-out;
}
.collapsible-content-inner {
    padding: 20px;
    border-top: 1px solid var(--border-color);
}

#key-opens-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}
.key-open-asset h4 {
    text-align: center;
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 16px;
    color: var(--subtle-text);
}
.key-open-table {
    width: 100%;
    border-collapse: collapse;
    margin: 0;
}
.key-open-table td {
    font-size: 14px;
    padding: 4px 2px;
    border: none;
}
.key-open-label {
    color: var(--subtle-text);
    text-align: left;
    width: 1%;
    padding-right: 10px;
}
.key-open-price {
    font-weight: 600;
    font-family: 'Courier New', Courier, monospace;
    text-align: right;
}
#key-opens-last-updated {
    grid-column: 1 / -1;
    text-align: center;
    font-size: 12px;
    color: var(--subtle-text);
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px dashed var(--border-color);
}
#key-opens-last-updated.updated-today span {
    color: #ffc107;
    font-weight: 500;
}
.key-open-price.updated-today-value {
    color: #ffc107;
}

.pill-button-group {
    display: inline-flex;
    vertical-align: middle;
}
.ema-pill-btn {
    font-size: 11px;
    padding: 4px 10px;
    margin: 0;
    border: 1px solid var(--border-color);
    background-color: transparent;
    color: var(--subtle-text);
    cursor: pointer;
    transition: all 0.2s ease;
}
.ema-pill-btn:first-of-type {
    border-top-left-radius: 12px;
    border-bottom-left-radius: 12px;
    border-right: 0.5px solid var(--border-color);
}
.ema-pill-btn:last-of-type {
    border-top-right-radius: 12px;
    border-bottom-right-radius: 12px;
    border-left: 0.5px solid var(--border-color);
}
.ema-pill-btn.active {
    background-color: var(--link-color);
    color: white;
    border-color: var(--link-color);
    font-weight: bold;
}

.trade-image-thumbnails {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
    max-width: 150px;
}
.trade-image-thumbnails .thumbnail-wrapper {
    position: relative;
    width: 40px;
    height: 40px;
}
.trade-image-thumbnails img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 4px;
    cursor: pointer;
    border: 1px solid var(--border-color);
}
.trade-image-thumbnails .delete-trade-image {
    position: absolute;
    top: -5px;
    right: -5px;
    width: 16px;
    height: 16px;
    background-color: rgba(220, 53, 69, 0.9);
    color: white;
    border: 1px solid white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    line-height: 10px;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.2s;
    padding: 0;
    z-index: 1;
}
.trade-image-thumbnails .thumbnail-wrapper:hover .delete-trade-image {
    opacity: 1;
}

.methodology-breakdown {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px dashed var(--border-color);
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 15px;
    justify-content: center;
}
.methodology-card {
    background-color: var(--bg-color);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 15px;
}
.methodology-card h4 {
    margin-top: 0;
    margin-bottom: 15px;
    text-align: center;
    font-size: 15px;
    color: var(--text-color);
    font-weight: 500;
}
.weight-group {
    margin-bottom: 15px;
}
.weight-group:last-child {
    margin-bottom: 0;
}
.weight-group-title {
    font-size: 12px;
    font-weight: bold;
    color: var(--subtle-text);
    margin: 0 0 8px 0;
    border-bottom: 1px solid var(--header-bg);
    padding-bottom: 4px;
}
.weight-item {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
    padding: 4px 0;
}
.weight-item span:first-child {
    color: var(--subtle-text);
}
.weight-item span:last-child {
    font-weight: 600;
    font-family: 'Courier New', Courier, monospace;
}
.card-description {
    font-size: 13px;
    line-height: 1.6;
    text-align: left;
    margin: 0;
    list-style-position: inside;
    padding-left: 0;
}
 .card-description li {
    margin-bottom: 8px;
 }

#notes-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 20px;
}
.note-item {
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: var(--container-bg);
    overflow: hidden;
    aspect-ratio: 1 / 1;
}
.note-item-header {
    padding: 15px;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    position: relative;
    transition: background-color 0.2s ease;
    height: 100%;
}
.note-item-header:hover {
    background-color: var(--header-bg);
}
.note-icon {
    font-size: 40px;
    margin-bottom: 10px;
}
.note-title {
    font-weight: 500;
    color: var(--text-color);
    word-break: break-word;
    margin: 0;
}
.note-delete-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background-color: transparent;
    border: 1px solid transparent;
    color: var(--subtle-text);
    cursor: pointer;
    font-size: 16px;
    line-height: 22px;
    padding: 0;
    transition: all 0.2s ease;
    opacity: 0.5;
}
.note-item:hover .note-delete-btn {
    opacity: 1;
}
.note-delete-btn:hover {
    background-color: var(--red-bg);
    color: var(--red-text);
    border-color: var(--red-border);
}

.note-modal-container {
    background-color: var(--container-bg);
    padding: 25px;
    border-radius: 12px;
    width: 90%;
    max-width: 800px;
    display: flex;
    flex-direction: column;
    box-shadow: 0 5px 25px var(--shadow-color);
    animation-name: zoomIn;
    animation-duration: 0.4s;
    margin: auto;
}
#note-modal-title {
    font-size: 24px;
    font-weight: 600;
    border: none;
    border-bottom: 2px solid var(--border-color);
    padding: 10px 5px;
    margin: 0 0 20px 0;
    background-color: transparent;
    flex-shrink: 0;
}
#note-modal-title:focus {
    outline: none;
    border-bottom-color: var(--link-color);
}
#note-modal-content {
    flex-grow: 1;
    font-size: 16px;
    line-height: 1.7;
    border: 1px solid var(--border-color);
    padding: 15px;
    resize: none;
    overflow-y: hidden; 
}
.note-modal-actions {
    margin-top: 20px;
    text-align: right;
    flex-shrink: 0;
}
#note-modal-close {
     width: auto;
     padding: 10px 20px;
}

.key-open-table td.key-open-price {
    width: 35%;
}
.key-open-note-cell {
    padding-left: 15px;
}
     .key-open-note {
    width: 100%;
    padding: 4px 6px;
    font-size: 12px;
    line-height: 1.4;
    background-color: transparent;
    border: 1px solid var(--border-color);
    border-radius: 3px;
    color: var(--text-color);
    font-family: inherit;
    resize: vertical;
    overflow-y: hidden;
    box-sizing: border-box;
    vertical-align: middle;
}
.key-open-note:focus {
    outline: 1px solid var(--link-color);
    background-color: var(--card-bg);
}

/* --- STYLES FOR CROSSOVER SIGNALS --- */
#crossover-signals-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}
.crossover-signals-table-wrapper h3 {
    text-align: center;
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1.1em;
    font-weight: 500;
}
.crossover-signals-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 0;
}
.crossover-signals-table th, .crossover-signals-table td {
    padding: 10px;
    font-size: 14px;
}
.crossover-signals-table th:first-child {
    text-align: left;
    padding-left: 15px;
    color: var(--link-color);
}
.crossover-signals-table td {
    text-align: center;
}
.crossover-signals-table td:first-child {
    font-weight: bold;
}
.crossover-signals-table .signal-cell {
    color: white;
    font-weight: bold;
    text-align: center;
}
.signal-cell-green { background-color: #27ae60; }
.signal-cell-red { background-color: #c0392b; }
.signal-cell-grey { background-color: #7f8c8d; }
.support-value {
    font-family: 'Courier New', Courier, monospace;
    font-weight: 500;
}

/* --- NEW STYLES FOR OPTIONS OI DASHBOARD --- */
#options-oi-tab .oi-global-metrics {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 20px;
    padding: 15px;
    margin-bottom: 25px;
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    text-align: center;
}
.oi-global-metric { font-size: 14px; }
.oi-global-metric .label { color: var(--subtle-text); display: block; font-size: 12px; margin-bottom: 4px; }
.oi-global-metric .value { font-weight: 600; font-size: 16px; font-family: 'Courier New', Courier, monospace; }
.oi-global-metric .value.pcr-bearish { color: var(--red-text); }
.oi-global-metric .value.pcr-bullish { color: var(--green-text); }

.oi-dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
}
.oi-card {
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    box-shadow: 0 1px 4px var(--shadow-color);
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}
.oi-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 10px var(--shadow-color);
}
.oi-card-header {
    padding: 12px 15px;
    background-color: var(--header-bg);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.oi-card-header h3 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
}
.oi-card-header .oi-type-pill { margin-left: 10px; }
.oi-card-body {
    padding: 15px;
    flex-grow: 1;
}
.oi-metric-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}
.oi-metric-item {
    text-align: center;
    padding: 10px;
    background-color: var(--bg-color);
    border-radius: 6px;
}
.oi-metric-item .label {
    font-size: 11px;
    color: var(--subtle-text);
    text-transform: uppercase;
    margin-bottom: 4px;
    display: block;
}
.oi-metric-item .value {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-color);
}
.oi-section-title {
    font-size: 14px;
    font-weight: 500;
    margin-top: 20px;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px solid var(--border-color);
    color: var(--subtle-text);
}
.oi-walls-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}
.wall-column h4 {
    margin: 0 0 8px 0;
    font-size: 13px;
    text-align: center;
}
.wall-column.calls h4 { color: var(--red-text); }
.wall-column.puts h4 { color: var(--green-text); }
.wall-item {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    padding: 4px 0;
    border-bottom: 1px solid var(--header-bg);
}
.wall-item:last-child { border-bottom: none; }
.wall-item .strike { font-weight: bold; font-family: 'Courier New', Courier, monospace; }
.wall-item .oi { color: var(--subtle-text); }
.gamma-zone-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 5px;
    font-size: 12px;
}
.gamma-zone-table th, .gamma-zone-table td {
    padding: 6px;
    text-align: right;
    border-bottom: 1px solid var(--header-bg);
}
.gamma-zone-table th { font-weight: 500; color: var(--subtle-text); }
.gamma-zone-table tr:last-child td { border-bottom: none; }
.gamma-zone-table .strike { font-weight: bold; font-family: 'Courier New', Courier, monospace; }
.oi-type-pill {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: bold;
    text-align: center;
    min-width: 80px;
}
.oi-type-quarterly { background-color: #ffc107; color: #333; }
.oi-type-monthly { background-color: var(--link-color); color: white; }
.oi-type-weekly { background-color: var(--card-bg); color: var(--subtle-text); border: 1px solid var(--border-color); }
.oi-type-daily { background-color: var(--header-bg); color: var(--subtle-text); }
.oi-card .tooltip {
  position: relative;
  display: inline-block;
  cursor: help;
  border-bottom: 1px dotted var(--subtle-text);
}
.oi-card .tooltip .tooltiptext {
  visibility: hidden;
  width: 250px;
  background-color: var(--header-bg);
  color: var(--text-color);
  text-align: left;
  border-radius: 6px;
  padding: 8px;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -125px;
  opacity: 0;
  transition: opacity 0.3s;
  border: 1px solid var(--border-color);
  box-shadow: 0 2px 5px var(--shadow-color);
  font-size: 12px;
  line-height: 1.5;
}
.oi-card .tooltip:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
}

@media (max-width: 768px) { 
    .container { padding: 10px; } 
    #add-trade-form { grid-template-columns: 1fr; } 
    .journal-image-wrapper { max-width: 100%; } 
    th, td { font-size: 12px; padding: 6px; } 
    .action-buttons button { font-size: 11px; padding: 4px 8px; } 
    #stats-panel-container { bottom: 10px; left: 10px; }
    #stats-fab { width: 50px; height: 50px; }
    #stats-panel { width: calc(100vw - 40px); }
    #sr-levels-container { grid-template-columns: 1fr; }
    #sr-metadata-container { flex-direction: column; }
    .theme-switch-wrapper { top: 8px; right: 10px; }
    #chart-library-2-preview-container {
        grid-template-columns: 1fr;
    }
    .modal-nav {
        width: 40px;
        height: 40px;
        font-size: 24px;
    }
    #modal-prev { left: 5px; }
    #modal-next { right: 5px; }
    .collapsible-content-inner { padding: 15px 10px; }
    .collapsible-header { padding: 10px 15px; }
    .collapsible-header h2 { font-size: 1em; }
    .ema-level-summary-grid { grid-template-columns: 1fr; }

    .modal-overlay {
        padding: 0;
    }
    .note-modal-container {
        width: 100%;
        min-height: 100%;
        height: auto;
        border-radius: 0;
        box-shadow: none;
        padding: 15px;
    }
    #note-modal-title { font-size: 20px; }
    #note-modal-content { font-size: 15px; }

    .setups-table th,
    .setups-table td {
        font-size: 11px;
        padding: 6px 5px;
    }

    .setups-table thead tr:first-of-type th:first-child,
    .setups-table tbody th:first-child {
        position: -webkit-sticky;
        position: sticky;
        left: 0;
    }

    .setups-table thead tr:first-of-type th:first-child {
        background-color: var(--header-bg);
        z-index: 2;
    }

    .setups-table tbody th:first-child {
        background-color: var(--card-bg);
        z-index: 1;
    }
    
    #key-opens-container {
        grid-template-columns: 1fr;
        gap: 25px;
    }
}




/* --- NEW STYLES FOR OPTIONS OI DASHBOARD --- */
#options-oi-tab .oi-global-metrics {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 20px;
    padding: 15px;
    margin-bottom: 25px;
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    text-align: center;
}
.oi-global-metric { font-size: 14px; }
.oi-global-metric .label { color: var(--subtle-text); display: block; font-size: 12px; margin-bottom: 4px; }
.oi-global-metric .value { font-weight: 600; font-size: 16px; font-family: 'Courier New', Courier, monospace; }
.oi-global-metric .value.pcr-bearish { color: var(--red-text); }
.oi-global-metric .value.pcr-bullish { color: var(--green-text); }

.oi-dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
}
.oi-card {
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    box-shadow: 0 1px 4px var(--shadow-color);
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}
.oi-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 10px var(--shadow-color);
}
.oi-card-header {
    padding: 12px 15px;
    background-color: var(--header-bg);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.oi-card-header h3 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
}
.oi-card-header .oi-type-pill { margin-left: 10px; }
.oi-card-body {
    padding: 15px;
    flex-grow: 1;
}
.oi-metric-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}
.oi-metric-item {
    text-align: center;
    padding: 10px;
    background-color: var(--bg-color);
    border-radius: 6px;
}
.oi-metric-item .label {
    font-size: 11px;
    color: var(--subtle-text);
    text-transform: uppercase;
    margin-bottom: 4px;
    display: block;
}
.oi-metric-item .value {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-color);
}
.oi-section-title {
    font-size: 14px;
    font-weight: 500;
    margin-top: 20px;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px solid var(--border-color);
    color: var(--subtle-text);
}
.oi-walls-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}
.wall-column h4 {
    margin: 0 0 8px 0;
    font-size: 13px;
    text-align: center;
}
.wall-column.calls h4 { color: var(--red-text); }
.wall-column.puts h4 { color: var(--green-text); }
.wall-item {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    padding: 4px 0;
    border-bottom: 1px solid var(--header-bg);
}
.wall-item:last-child { border-bottom: none; }
.wall-item .strike { font-weight: bold; font-family: 'Courier New', Courier, monospace; }
.wall-item .oi { color: var(--subtle-text); }
.gamma-zone-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 5px;
    font-size: 12px;
}
.gamma-zone-table th, .gamma-zone-table td {
    padding: 6px;
    text-align: right;
    border-bottom: 1px solid var(--header-bg);
}
.gamma-zone-table th { font-weight: 500; color: var(--subtle-text); }
.gamma-zone-table tr:last-child td { border-bottom: none; }
.gamma-zone-table .strike { font-weight: bold; font-family: 'Courier New', Courier, monospace; }
.oi-type-pill {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: bold;
    text-align: center;
    min-width: 80px;
}
.oi-type-quarterly { background-color: #ffc107; color: #333; }
.oi-type-monthly { background-color: var(--link-color); color: white; }
.oi-type-weekly { background-color: var(--card-bg); color: var(--subtle-text); border: 1px solid var(--border-color); }
.oi-type-daily { background-color: var(--header-bg); color: var(--subtle-text); }
.oi-card .tooltip {
  position: relative;
  display: inline-block;
  cursor: help;
  border-bottom: 1px dotted var(--subtle-text);
}
.oi-card .tooltip .tooltiptext {
  visibility: hidden;
  width: 250px;
  background-color: var(--header-bg);
  color: var(--text-color);
  text-align: left;
  border-radius: 6px;
  padding: 8px;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -125px;
  opacity: 0;
  transition: opacity 0.3s;
  border: 1px solid var(--border-color);
  box-shadow: 0 2px 5px var(--shadow-color);
  font-size: 12px;
  line-height: 1.5;
}
.oi-card .tooltip:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
}

/* --- NEW STYLES FOR HISTORICAL CHARTS --- */
#charts-tab .chart-container {
    position: relative;
    margin: 0 auto 40px auto;
    padding: 20px;
    background-color: var(--container-bg);
    border-radius: 8px;
    box-shadow: 0 4px 6px var(--shadow-color);
    max-width: 1200px;
}
#charts-tab #last-updated-charts { text-align: center; color: var(--subtle-text); margin-top: -10px; margin-bottom: 20px; }


        /* --- NEW STYLES FOR HISTORICAL CHARTS --- */
#charts-tab .chart-container,
#options-oi-tab .chart-container { /* <--- ADD THIS LINE */
    position: relative;
    margin: 0 auto 40px auto;
    padding: 20px;
    background-color: var(--container-bg);
    border-radius: 8px;
    box-shadow: 0 4px 6px var(--shadow-color);
    max-width: 1200px;
    
}
#charts-tab #last-updated-charts,
#options-oi-tab #last-updated-charts { /* <--- ADD THIS LINE */
    text-align: center; 
    color: var(--subtle-text); 
    margin-top: 0; /* Changed from -10px */
    margin-bottom: 20px; 
}

@media (max-width: 768px) { 
    /* ... your other mobile styles ... */

    /* ADD THIS NEW RULE FOR THE CHARTS */
    #options-oi-tab .chart-container {
        aspect-ratio: 1 / 1.1; /* Makes the chart nearly square (width / height) */
        min-height: 350px; /* Optional: ensures it's never TOO small */
    }
}
